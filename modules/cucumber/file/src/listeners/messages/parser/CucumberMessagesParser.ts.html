<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-85788349-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-85788349-2');
    </script>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="/modules/cucumber/">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,900,700,400italic" rel="stylesheet">
    <title> | Serenity/JS</title>
    <meta property="og:title" content=" | Serenity/JS"/>
    <meta property="og:description" content="Full-stack acceptance testing with Serenity/JS"/>
    <meta property="og:image" content="https://serenity-js.org/images/serenity-js-banner.png"/>
    <meta property="og:url" content="https://serenity-js.org/modules/cucumber/file/src/listeners/messages/parser/CucumberMessagesParser.ts.html"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/icons/site.webmanifest">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/css/charming-pro-serenity-js.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css"
          integrity="sha256-zmfNZmXoNWBMemUOo1XUGFfc0ihGGLYdgtJS3KCr/l0=" crossorigin="anonymous" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css"
          integrity="sha256-AJfZWudfDWpFpIZ3USExGYDGwsYz47IgfEQCiGTm4wQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" integrity="sha256-3YM6A3pH4QFCl9WbSU8oXF5N6W/2ylvW0o2g+Z6TmLQ=" crossorigin="anonymous" />
</head>
<body>

<div id="top"
        class="block block-dark block-bb bg-gradient-accent-2 p-0">
    <div class="container">
        <nav id="web-nav" class="web-nav web-nav-light">
            <header>
                <a href="/" class="serenity-js-logo">
                    <svg width="190px" height="42px" viewBox="0 0 1077 243" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
                        <path class="logo-accent" d="M295.133,157.626l22.342,0c1.571,12.567 6.633,23.04 27.753,23.04c13.789,0 23.563,-7.68 23.563,-19.2c0,-11.52 -5.76,-15.884 -26.007,-19.2c-29.847,-4.015 -43.985,-13.091 -43.985,-36.48c0,-20.422 17.454,-35.782 43.461,-35.782c26.881,0 42.938,12.219 45.382,36.131l-21.294,0c-2.27,-13.091 -9.775,-18.676 -24.088,-18.676c-14.138,0 -21.469,6.807 -21.469,16.407c0,10.123 4.19,15.186 25.833,18.327c29.323,4.015 44.509,12.393 44.509,37.353c0,21.643 -18.327,38.574 -45.905,38.574c-34.036,0 -48.35,-16.931 -50.095,-40.494" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M472.468,141.219c-1.048,-15.709 -9.077,-22.691 -22.168,-22.691c-12.741,0 -21.294,8.552 -23.389,22.691l45.557,0Zm-67.55,10.473l0,-1.397c0,-28.276 19.375,-47.127 45.382,-47.127c22.691,0 43.113,13.44 43.113,46.08l0,6.109l-66.851,0c0.698,17.28 9.426,27.054 25.135,27.054c12.742,0 19.375,-5.061 20.945,-13.963l20.422,0c-2.967,19.2 -18.502,29.672 -41.891,29.672c-26.88,0 -46.255,-17.629 -46.255,-46.428" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M513.481,105.088l14.487,0l0,16.407c5.761,-10.298 13.616,-17.454 30.023,-17.978l0,13.615c-18.327,0.872 -30.023,6.633 -30.023,29.148l0,50.095l-14.487,0l0,-91.287Z" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M637.754,141.917c-1.396,-18.851 -11.171,-26.356 -26.182,-26.356c-14.836,0 -24.785,10.124 -27.229,26.356l53.411,0Zm-68.945,9.774l0,-1.396c0,-27.578 17.629,-46.778 42.763,-46.778c21.12,0 41.019,12.742 41.019,45.381l0,4.713l-68.772,0c0.699,20.771 10.648,32.291 29.325,32.291c14.137,0 22.341,-5.236 24.261,-15.883l14.488,0c-3.143,18.327 -18.328,27.927 -38.924,27.927c-25.833,0 -44.16,-18.153 -44.16,-46.255" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M673.882,105.088l14.487,0l0,14.487c4.189,-8.552 14.313,-16.058 29.324,-16.058c18.85,0 32.116,10.299 32.116,36.829l0,56.029l-14.488,0l0,-57.076c0,-16.059 -6.806,-23.215 -21.468,-23.215c-13.441,0 -25.484,8.553 -25.484,24.96l0,55.331l-14.487,0l0,-91.287Z" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M772.733,105.088l14.486,0l0,91.287l-14.487,0l0,-91.287Zm-2.618,-28.626c0,-5.237 4.365,-9.6 9.601,-9.6c5.236,0 9.599,4.363 9.599,9.6c0,5.237 -4.363,9.6 -9.599,9.6c-5.236,0 -9.601,-4.363 -9.601,-9.6" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M819.16,173.51l0,-56.204l-13.091,0l0,-12.218l13.091,0l0,-20.77l14.487,0l0,20.77l21.294,0l0,12.218l-21.294,0l0,54.808c0,8.901 4.015,13.265 11.346,13.265c4.538,0 8.028,-0.698 11.171,-1.92l0,12.218c-2.968,1.047 -6.459,1.92 -12.394,1.92c-16.581,0 -24.61,-9.774 -24.61,-24.087" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M902.589,186.949l-35.782,-81.861l15.535,0l27.927,65.454l25.309,-65.454l14.836,0l-50.443,123.054l-14.662,0l17.28,-41.193Z" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M996.26,100.15l7.752,0l-22.728,69.537l-7.675,0l22.651,-69.537Z" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M1002.35,157.646l0,-7.826c1.882,0.752 3.763,1.353 6.924,1.353c4.891,0 8.053,-2.558 8.053,-9.181l0,-37.252l10.084,0l0,37.478c0,11.664 -6.698,17.008 -16.632,17.008c-4.44,0 -6.698,-0.678 -8.429,-1.58" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M1035.46,141.841l9.633,0c0.678,5.42 2.86,9.934 11.966,9.934c5.945,0 10.16,-3.311 10.16,-8.278c0,-4.967 -2.484,-6.847 -11.214,-8.277c-12.868,-1.733 -18.964,-5.645 -18.964,-15.729c0,-8.806 7.525,-15.427 18.738,-15.427c11.59,0 18.514,5.267 19.567,15.578l-9.181,0c-0.978,-5.645 -4.215,-8.053 -10.386,-8.053c-6.095,0 -9.256,2.934 -9.256,7.074c0,4.366 1.806,6.547 11.138,7.901c12.643,1.732 19.191,5.343 19.191,16.105c0,9.332 -7.903,16.633 -19.793,16.633c-14.675,0 -20.846,-7.301 -21.599,-17.461" style="fill-rule:nonzero;"/>
                        <path class="logo-accent" d="M152.636,121.232c0,17.344 -14.06,31.404 -31.404,31.404c-17.344,0 -31.405,-14.06 -31.405,-31.404c0,-17.344 14.061,-31.404 31.405,-31.404c17.344,0 31.404,14.06 31.404,31.404" style="fill-rule:nonzero;"/>
                        <path class="logo-base"   d="M230.534,68.726l-67.217,67.217l46.941,0c-7.045,42.781 -44.281,75.521 -89.026,75.521c-31.396,0 -59.086,-16.127 -75.255,-40.523l-22.286,22.287c22.081,29.866 57.547,49.236 97.541,49.236c66.955,0 121.232,-54.277 121.232,-121.232c0,-18.81 -4.284,-36.619 -11.93,-52.506m-198.328,37.796c7.045,-42.782 44.281,-75.522 89.026,-75.522c31.396,0 59.086,16.127 75.255,40.523l22.286,-22.286c-22.081,-29.867 -57.547,-49.237 -97.541,-49.237c-66.955,0 -121.232,54.278 -121.232,121.232c0,18.811 4.284,36.62 11.93,52.506l67.217,-67.216l-46.941,0Z" style="fill-rule:nonzero;"/>
                    </svg>
                </a>
        
                <a href="#!" class="web-nav-toggler">
                    <span class="fa fa-close"></span>
                    <span class="fa fa-bars"></span>
                </a>
            </header>
        
            <div class="web-nav-list">
                <a href="/handbook" class="web-nav-item">Handbook</a>
                <a href="/modules" class="web-nav-item">Modules</a>
                <a href="/changelog.html" class="web-nav-item">Changelog</a>
                <a href="/support.html" class="web-nav-item">Support</a>
                <a href="/community/sponsors.html" class="web-nav-item">Sponsors</a>
                <a href="https://twitter.com/SerenityJS" class="web-nav-item">
                    <span class="d-block d-lg-none">@SerenityJS on Twitter</span><span class="fab fa-twitter d-none d-lg-inline"> </span>
                </a>
                <a href="https://github.com/serenity-js" class="web-nav-item">
                    <span class="d-block d-lg-none">Source code</span><span class="fab fa-github d-none d-lg-inline"> </span>
                </a>
            </div>
        
            <div id="web-nav-mobile-indicator"><!-- this signals to the javascript if the navigation is mobile or not --></div>
        </nav>
    </div>
</div>

<section id="api-docs">
<html><head></head><body><section>
    <main class="container">
        <div class="row">
            <aside id="sidebar" class="col-lg-3 col-md-12">
                <nav class="toc navigation text-truncate" data-ice="nav">
                    <ul class="summary">
                        <li class="header"><a href="/modules">Modules</a></li>
                        <li class="chapter"><a href="/modules/assertions" title="Screenplay-style assertion library" class="">@serenity-js/assertions</a></li>
                        <li class="chapter"><a href="/modules/console-reporter" title="Serenity/JS console reporter" class="">@serenity-js/console-reporter</a></li>
                        <li class="chapter"><a href="/modules/core" title="Serenity/JS Screenplay, reporting engine and core interfaces." class="">@serenity-js/core</a></li>
                        <li class="chapter"><a href="/modules/cucumber" title="Serenity/JS adapter for Cucumber test runners version 1.x - 7.x" class="active">@serenity-js/cucumber</a></li>
                        <li class="chapter"><a href="/modules/jasmine" title="Serenity/JS adapter for the Jasmine test runner" class="">@serenity-js/jasmine</a></li>
                        <li class="chapter"><a href="/modules/local-server" title="Enables Serenity/JS Actors to manage local Node.js test servers, such as Express, Koa or Restify" class="">@serenity-js/local-server</a></li>
                        <li class="chapter"><a href="/modules/mocha" title="Serenity/JS adapter for Mocha" class="">@serenity-js/mocha</a></li>
                        <li class="chapter"><a href="/modules/protractor" title="Test your web apps with Serenity/JS" class="">@serenity-js/protractor</a></li>
                        <li class="chapter"><a href="/modules/rest" title="Test REST APIs with Serenity/JS" class="">@serenity-js/rest</a></li>
                        <li class="chapter"><a href="/modules/serenity-bdd" title="Serenity BDD reporter for Serenity/JS" class="">@serenity-js/serenity-bdd</a></li>
                    </ul>
                    <ul class="summary">
                        <li class="header"><a href="index.html">cucumber</a></li>
                        <li class="chapter"><a href="index.html">Readme</a></li>
                        <li class="chapter"><a href="source.html">Source code</a></li>
                        <li class="chapter"><a href="test.html" data-ice="testLink">Specs</a></li>
                        <li class="chapter"><a href="identifiers.html">API Reference</a></li>
                    </ul>
                <div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cli">cli</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cli/CucumberCLIAdapter.ts~CucumberCLIAdapter.html">CucumberCLIAdapter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cli/CucumberFormat.ts~CucumberFormat.html">CucumberFormat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/cli/CucumberConfig.ts~CucumberConfig.html">CucumberConfig</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#errors">errors</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/AmbiguousStepDefinitionError.ts~AmbiguousStepDefinitionError.html">AmbiguousStepDefinitionError</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#listeners-legacy">listeners/legacy</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createListener">createListener</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#listeners-messages">listeners/messages</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createListener">createListener</a></span></span></li>
</ul>
</div>
</nav>
            </aside>

            <section class="col-lg-9 col-md-12">
                <article class="content" data-ice="content"><h1 data-ice="title">src/listeners/messages/parser/CucumberMessagesParser.ts</h1>
<pre class="source-code line-number raw-source-code"><code class="linenums hljs ts" data-ice="content"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GherkinDocument</span>, <span class="hljs-title class_">Location</span>, <span class="hljs-title class_">Pickle</span>, <span class="hljs-title class_">TestCaseFinished</span>, <span class="hljs-title class_">TestCaseStarted</span>, <span class="hljs-title class_">TestStepFinished</span>, <span class="hljs-title class_">TestStepResult</span>, <span class="hljs-title class_">TestStepStarted</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cucumber/messages'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TestStepResultStatus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@cucumber/messages'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AssertionError</span>, <span class="hljs-title class_">ImplementationPendingError</span>, <span class="hljs-title class_">Serenity</span>, <span class="hljs-title class_">TestCompromisedError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@serenity-js/core'</span>;
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">BusinessRuleDetected</span>,
    <span class="hljs-title class_">DomainEvent</span>,
    <span class="hljs-title class_">FeatureNarrativeDetected</span>,
    <span class="hljs-title class_">RetryableSceneDetected</span>,
    <span class="hljs-title class_">SceneDescriptionDetected</span>,
    <span class="hljs-title class_">SceneFinished</span>,
    <span class="hljs-title class_">SceneFinishes</span>,
    <span class="hljs-title class_">SceneParametersDetected</span>,
    <span class="hljs-title class_">SceneSequenceDetected</span>,
    <span class="hljs-title class_">SceneStarts</span>,
    <span class="hljs-title class_">SceneTagged</span>,
    <span class="hljs-title class_">SceneTemplateDetected</span>,
    <span class="hljs-title class_">TaskFinished</span>,
    <span class="hljs-title class_">TaskStarts</span>,
    <span class="hljs-title class_">TestRunnerDetected</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@serenity-js/core/lib/events'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorSerialiser</span>, <span class="hljs-title class_">FileSystemLocation</span>, <span class="hljs-title class_">Path</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@serenity-js/core/lib/io'</span>;
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">ActivityDetails</span>,
    <span class="hljs-title class_">ArbitraryTag</span>,
    <span class="hljs-title class_">BusinessRule</span>,
    <span class="hljs-title class_">CapabilityTag</span>,
    <span class="hljs-title class_">Category</span>,
    <span class="hljs-title class_">CorrelationId</span>,
    <span class="hljs-title class_">Description</span>,
    <span class="hljs-title class_">ExecutionCompromised</span>,
    <span class="hljs-title class_">ExecutionFailedWithAssertionError</span>,
    <span class="hljs-title class_">ExecutionFailedWithError</span>,
    <span class="hljs-title class_">ExecutionRetriedTag</span>,
    <span class="hljs-title class_">ExecutionSkipped</span>,
    <span class="hljs-title class_">ExecutionSuccessful</span>,
    <span class="hljs-title class_">FeatureTag</span>,
    <span class="hljs-title class_">ImplementationPending</span>,
    <span class="hljs-title class_">Name</span>,
    <span class="hljs-title class_">Outcome</span>,
    <span class="hljs-title class_">ScenarioDetails</span>,
    <span class="hljs-title class_">ScenarioParameters</span>,
    <span class="hljs-title class_">Tag</span>,
    <span class="hljs-title class_">Tags</span>,
    <span class="hljs-title class_">ThemeTag</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@serenity-js/core/lib/model'</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventDataCollector</span>, IParsedTestStep, ITestCaseAttempt } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types/cucumber'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TestStepFormatter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./TestStepFormatter'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ExtractedScenario</span>, <span class="hljs-title class_">ExtractedScenarioOutline</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./types'</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@package</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CucumberMessagesParser</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> testStepFormatter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestStepFormatter</span>();

    <span class="hljs-keyword">private</span> <span class="hljs-attr">currentScenario</span>: <span class="hljs-title class_">ScenarioDetails</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-attr">currentStepActivityId</span>: <span class="hljs-title class_">CorrelationId</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">cwd</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">eventDataCollector</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">snippetBuilder</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">supportCodeLibrary</span>: <span class="hljs-built_in">any</span>;

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> serenity: Serenity,
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> formatterHelpers: <span class="hljs-built_in">any</span>,     <span class="hljs-comment">// eslint-disable-line @typescript-eslint/explicit-module-boundary-types</span>
        formatterOptionsAndDependencies: {
            cwd: <span class="hljs-built_in">string</span>,
            eventDataCollector: EventDataCollector,
            snippetBuilder: <span class="hljs-built_in">any</span>,
            supportCodeLibrary: <span class="hljs-built_in">any</span>,
        },
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> shouldReportStep: (parsedTestStep: IParsedTestStep) =&gt; <span class="hljs-built_in">boolean</span>,
    </span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cwd</span>                = formatterOptionsAndDependencies.<span class="hljs-property">cwd</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventDataCollector</span> = formatterOptionsAndDependencies.<span class="hljs-property">eventDataCollector</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">snippetBuilder</span>     = formatterOptionsAndDependencies.<span class="hljs-property">snippetBuilder</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportCodeLibrary</span> = formatterOptionsAndDependencies.<span class="hljs-property">supportCodeLibrary</span>;
    }

    <span class="hljs-title function_">parseTestCaseStarted</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">TestCaseStarted</span>): <span class="hljs-title class_">DomainEvent</span>[] {
        <span class="hljs-keyword">const</span>
            testCaseAttempt = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventDataCollector</span>.<span class="hljs-title function_">getTestCaseAttempt</span>(message.<span class="hljs-property">id</span>),
            currentSceneId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">assignNewSceneId</span>();

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scenarioDetailsFor</span>(
            testCaseAttempt.<span class="hljs-property">gherkinDocument</span>,
            testCaseAttempt.<span class="hljs-property">pickle</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-property">PickleParser</span>.<span class="hljs-title function_">getPickleLocation</span>(testCaseAttempt),
        );

        <span class="hljs-keyword">return</span> [
            ...<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extract</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">outlineFrom</span>(testCaseAttempt), <span class="hljs-function"><span class="hljs-params">outline</span> =&gt;</span> [
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneSequenceDetected</span>(currentSceneId, outline.<span class="hljs-property">details</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneTemplateDetected</span>(currentSceneId, outline.<span class="hljs-property">template</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneParametersDetected</span>(
                    currentSceneId,
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span>,
                    outline.<span class="hljs-property">parameters</span>,
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>(),
                ),
            ]),

            ...<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extract</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scenarioFrom</span>(testCaseAttempt), <span class="hljs-function">(<span class="hljs-params">{ featureDescription, rule, scenarioDescription, tags, testRunnerName }</span>) =&gt;</span> [
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneStarts</span>(currentSceneId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                featureDescription &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">FeatureNarrativeDetected</span>(currentSceneId, featureDescription, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestRunnerDetected</span>(currentSceneId, testRunnerName, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                !! scenarioDescription &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneDescriptionDetected</span>(currentSceneId, scenarioDescription, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                !! rule &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessRuleDetected</span>(currentSceneId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span>, rule, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()),
                ...tags.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneTagged</span>(currentSceneId, tag, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>())),
            ]),
        ];
    }

    <span class="hljs-title function_">parseTestStepStarted</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">TestStepStarted</span>): <span class="hljs-title class_">DomainEvent</span>[] {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extract</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stepFrom</span>(message), <span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStepActivityId</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">assignNewActivityId</span>();

            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldReportStep</span>(step)) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskStarts</span>(
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentSceneId</span>(),
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStepActivityId</span>,
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">activityDetailsFor</span>(step),
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()
                )
            }
        });
    }

    <span class="hljs-title function_">parseTestStepFinished</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">TestStepStarted</span>): <span class="hljs-title class_">DomainEvent</span>[] {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extract</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stepFrom</span>(message), <span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">shouldReportStep</span>(step)) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskFinished</span>(
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentSceneId</span>(),
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStepActivityId</span>,
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">activityDetailsFor</span>(step),
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">outcomeFrom</span>(step.<span class="hljs-property">result</span>, step),
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()
                );
            }
        })
    }

    <span class="hljs-title function_">parseTestCaseFinishes</span>(<span class="hljs-attr">hookMessage</span>: { <span class="hljs-attr">testCaseStartedId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">result</span>: <span class="hljs-title class_">TestStepResult</span> }): <span class="hljs-title class_">DomainEvent</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneFinishes</span>(
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentSceneId</span>(),
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">outcomeFrom</span>(hookMessage.<span class="hljs-property">result</span>),
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()
        );
    }

    <span class="hljs-title function_">parseTestCaseFinished</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">TestCaseFinished</span>): <span class="hljs-title class_">DomainEvent</span>[] {
        <span class="hljs-keyword">const</span>
            testCaseAttempt = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventDataCollector</span>.<span class="hljs-title function_">getTestCaseAttempt</span>(message.<span class="hljs-property">testCaseStartedId</span>),
            currentSceneId  = <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentSceneId</span>();

        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extract</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scenarioOutcomeFrom</span>(testCaseAttempt), <span class="hljs-function">(<span class="hljs-params">{ outcome, willBeRetried, tags }</span>) =&gt;</span> [
            willBeRetried ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryableSceneDetected</span>(currentSceneId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()) : <span class="hljs-literal">undefined</span>,
            ...tags.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneTagged</span>(currentSceneId, tag, <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>())),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">SceneFinished</span>(
                currentSceneId,
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentScenario</span>,
                outcome,
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">serenity</span>.<span class="hljs-title function_">currentTime</span>()
            ),
        ]);
    }

    <span class="hljs-comment">// ---</span>

    <span class="hljs-keyword">private</span> extract&lt;T&gt;(<span class="hljs-attr">maybeValue</span>: T | <span class="hljs-literal">undefined</span>, <span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-title class_">DomainEvent</span>[] | <span class="hljs-title class_">DomainEvent</span> | <span class="hljs-built_in">void</span>): <span class="hljs-title class_">DomainEvent</span>[] {
        <span class="hljs-keyword">return</span> (maybeValue !== <span class="hljs-literal">undefined</span>)
            ? [].<span class="hljs-title function_">concat</span>(<span class="hljs-title function_">fn</span>(maybeValue)).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !! item)
            : [];
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">scenarioDetailsFor</span>(<span class="hljs-attr">gherkinDocument</span>: <span class="hljs-title class_">GherkinDocument</span>, <span class="hljs-attr">pickle</span>: <span class="hljs-title class_">Pickle</span>, <span class="hljs-attr">location</span>: <span class="hljs-title class_">Location</span>): <span class="hljs-title class_">ScenarioDetails</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScenarioDetails</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>(pickle.<span class="hljs-property">name</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Category</span>(gherkinDocument.<span class="hljs-property">feature</span>.<span class="hljs-property">name</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemLocation</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(gherkinDocument.<span class="hljs-property">uri</span>),
                location.<span class="hljs-property">line</span>,
                location.<span class="hljs-property">column</span>,
            ),
        );
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">outlineFrom</span>(<span class="hljs-attr">testCaseAttempt</span>: ITestCaseAttempt): <span class="hljs-title class_">ExtractedScenarioOutline</span> {
        <span class="hljs-keyword">const</span>
            { gherkinDocument, pickle } = testCaseAttempt,
            gherkinScenarioMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-property">GherkinDocumentParser</span>.<span class="hljs-title function_">getGherkinScenarioMap</span>(gherkinDocument);

        <span class="hljs-keyword">if</span> (gherkinScenarioMap[pickle.<span class="hljs-property">astNodeIds</span>[<span class="hljs-number">0</span>]].<span class="hljs-property">examples</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// this is not an outline, skip it</span>
        }

        <span class="hljs-keyword">const</span> outline   = gherkinScenarioMap[pickle.<span class="hljs-property">astNodeIds</span>[<span class="hljs-number">0</span>]];
        <span class="hljs-keyword">const</span> details   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scenarioDetailsFor</span>(gherkinDocument, outline, outline.<span class="hljs-property">location</span>);
        <span class="hljs-keyword">const</span> template  = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Description</span>(outline.<span class="hljs-property">steps</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">testStepFormatter</span>.<span class="hljs-title function_">format</span>(step.<span class="hljs-property">keyword</span>, step.<span class="hljs-property">text</span>, step)).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>));

        <span class="hljs-keyword">const</span> examples = <span class="hljs-title function_">flatten</span>(
            outline.<span class="hljs-property">examples</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">exampleSet</span> =&gt;</span>
                exampleSet.<span class="hljs-property">tableBody</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> ({
                    <span class="hljs-attr">header</span>: exampleSet.<span class="hljs-property">tableHeader</span>,
                    row,
                    <span class="hljs-attr">name</span>: exampleSet.<span class="hljs-property">name</span>,
                    <span class="hljs-attr">description</span>: exampleSet.<span class="hljs-property">description</span>,
                }))
            ),
        ).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">example: <span class="hljs-built_in">any</span></span>) =&gt;</span> ({
            <span class="hljs-attr">rowId</span>:          example.<span class="hljs-property">row</span>.<span class="hljs-property">id</span>,
            <span class="hljs-attr">name</span>:           example.<span class="hljs-property">name</span>.<span class="hljs-title function_">trim</span>(),
            <span class="hljs-attr">description</span>:    example.<span class="hljs-property">description</span>.<span class="hljs-title function_">trim</span>(),
            <span class="hljs-attr">values</span>:         example.<span class="hljs-property">header</span>.<span class="hljs-property">cells</span>
                .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">cell</span> =&gt;</span> cell.<span class="hljs-property">value</span>)
                .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">values, header, i</span>) =&gt;</span> {
                    values[header] = example.<span class="hljs-property">row</span>.<span class="hljs-property">cells</span>[i].<span class="hljs-property">value</span>;
                    <span class="hljs-keyword">return</span> values;
                }, {}),
        }));

        <span class="hljs-keyword">const</span> parameters = examples.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">example</span> =&gt;</span> example.<span class="hljs-property">rowId</span> === pickle.<span class="hljs-property">astNodeIds</span>[pickle.<span class="hljs-property">astNodeIds</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]);

        <span class="hljs-keyword">return</span> {
            details, template, <span class="hljs-attr">parameters</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScenarioParameters</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>(parameters.<span class="hljs-property">name</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Description</span>(parameters.<span class="hljs-property">description</span>), parameters.<span class="hljs-property">values</span>),
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">scenarioFrom</span>({ gherkinDocument, pickle }: ITestCaseAttempt): <span class="hljs-title class_">ExtractedScenario</span> {
        <span class="hljs-keyword">const</span>
            gherkinScenarioMap      = <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-property">GherkinDocumentParser</span>.<span class="hljs-title function_">getGherkinScenarioMap</span>(gherkinDocument),
            gherkinExampleRuleMap   = <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-property">GherkinDocumentParser</span>.<span class="hljs-title function_">getGherkinExampleRuleMap</span>(gherkinDocument),
            scenarioDescription     = <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-property">PickleParser</span>.<span class="hljs-title function_">getScenarioDescription</span>({ gherkinScenarioMap, pickle }),
            <span class="hljs-attr">scenarioTags</span>: <span class="hljs-title class_">Tag</span>[]     = flatten&lt;<span class="hljs-title class_">Tag</span>&gt;(pickle.<span class="hljs-property">tags</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> <span class="hljs-title class_">Tags</span>.<span class="hljs-title function_">from</span>(tag.<span class="hljs-property">name</span>))),
            rule                    = gherkinExampleRuleMap[pickle.<span class="hljs-property">astNodeIds</span>[<span class="hljs-number">0</span>]];

        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">featureDescription</span>:     gherkinDocument.<span class="hljs-property">feature</span>.<span class="hljs-property">description</span> &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Description</span>(gherkinDocument.<span class="hljs-property">feature</span>.<span class="hljs-property">description</span>),
            <span class="hljs-attr">scenarioDescription</span>:    scenarioDescription &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Description</span>(scenarioDescription),
            <span class="hljs-attr">rule</span>:                   rule &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessRule</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>(rule.<span class="hljs-property">name</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Description</span>(rule.<span class="hljs-property">description</span>.<span class="hljs-title function_">trim</span>())),
            <span class="hljs-attr">testRunnerName</span>:         <span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>(<span class="hljs-string">'Cucumber'</span>),
            <span class="hljs-attr">tags</span>:                   <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scenarioHierarchyTagsFor</span>(gherkinDocument, pickle).<span class="hljs-title function_">concat</span>(scenarioTags),
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">scenarioHierarchyTagsFor</span>(<span class="hljs-attr">gherkinDocument</span>: <span class="hljs-title class_">GherkinDocument</span>, <span class="hljs-attr">pickle</span>: <span class="hljs-title class_">Pickle</span>): <span class="hljs-title class_">Tag</span>[] {
        <span class="hljs-keyword">const</span>
            directories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(pickle.<span class="hljs-property">uri</span>).<span class="hljs-title function_">directory</span>().<span class="hljs-title function_">split</span>(),
            featuresIndex = directories.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'features'</span>),
            hierarchy = [...directories.<span class="hljs-title function_">slice</span>(featuresIndex + <span class="hljs-number">1</span>), gherkinDocument.<span class="hljs-property">feature</span>.<span class="hljs-property">name</span>];

        <span class="hljs-keyword">const</span> [featureName, capabilityName, themeName]: <span class="hljs-built_in">string</span>[] = hierarchy.<span class="hljs-title function_">reverse</span>();

        <span class="hljs-keyword">return</span> <span class="hljs-title function_">notEmpty</span>([
            themeName &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThemeTag</span>(themeName),
            capabilityName &amp;&amp; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CapabilityTag</span>(capabilityName),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">FeatureTag</span>(featureName),
        ]);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">stepFrom</span>(<span class="hljs-params">message: TestStepStarted | TestStepFinished</span>) {
        <span class="hljs-keyword">const</span> { testCaseStartedId, testStepId } = message;

        <span class="hljs-keyword">const</span> testCaseAttempt = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventDataCollector</span>.<span class="hljs-title function_">getTestCaseAttempt</span>(testCaseStartedId);

        <span class="hljs-keyword">const</span> index = testCaseAttempt.<span class="hljs-property">testCase</span>.<span class="hljs-property">testSteps</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> step.<span class="hljs-property">id</span> === testStepId);

        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseTestCaseAttempt</span>(testCaseAttempt).<span class="hljs-property">testSteps</span>[index];
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">parseTestCaseAttempt</span>(<span class="hljs-params">testCaseAttempt: ITestCaseAttempt</span>) {
        <span class="hljs-comment">// todo: workaround for https://github.com/cucumber/cucumber-js/pull/1531</span>
        <span class="hljs-comment">//  can be removed when the above PR is merged</span>
        testCaseAttempt.<span class="hljs-property">testCase</span>.<span class="hljs-property">testSteps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (! testCaseAttempt.<span class="hljs-property">stepResults</span>[step.<span class="hljs-property">id</span>]) {
                testCaseAttempt.<span class="hljs-property">stepResults</span>[step.<span class="hljs-property">id</span>] = { <span class="hljs-attr">duration</span>: { <span class="hljs-attr">seconds</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">nanos</span>: <span class="hljs-number">0</span> }, <span class="hljs-attr">status</span>: <span class="hljs-title class_">TestStepResultStatus</span>.<span class="hljs-property">UNKNOWN</span>, <span class="hljs-attr">willBeRetried</span>: <span class="hljs-literal">false</span> };
            }
        });
        <span class="hljs-comment">// ---</span>

        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-title function_">parseTestCaseAttempt</span>({
            <span class="hljs-attr">cwd</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cwd</span>,
            testCaseAttempt,
            <span class="hljs-attr">snippetBuilder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">snippetBuilder</span>,
            <span class="hljs-attr">supportCodeLibrary</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportCodeLibrary</span>,
        });
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">activityDetailsFor</span>(<span class="hljs-attr">parsedTestStep</span>: IParsedTestStep): <span class="hljs-title class_">ActivityDetails</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityDetails</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Name</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testStepFormatter</span>.<span class="hljs-title function_">format</span>(parsedTestStep.<span class="hljs-property">keyword</span>, parsedTestStep.<span class="hljs-property">text</span>, parsedTestStep.<span class="hljs-property">argument</span>)));
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">outcomeFrom</span>(<span class="hljs-attr">worstResult</span>: <span class="hljs-title class_">TestStepResult</span>, ...<span class="hljs-attr">steps</span>: IParsedTestStep[]): <span class="hljs-title class_">Outcome</span> {

        <span class="hljs-keyword">const</span> <span class="hljs-title class_">Status</span> = <span class="hljs-title class_">TestStepResultStatus</span>;

        <span class="hljs-keyword">switch</span> (worstResult.<span class="hljs-property">status</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">SKIPPED</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionSkipped</span>();

            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">UNDEFINED</span>: {
                <span class="hljs-keyword">const</span> snippets = steps
                    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> step.<span class="hljs-property">result</span>.<span class="hljs-property">status</span> === <span class="hljs-title class_">Status</span>.<span class="hljs-property">UNDEFINED</span>)
                    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> step.<span class="hljs-property">snippet</span>);

                <span class="hljs-keyword">const</span> message = snippets.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
                    ? [<span class="hljs-string">'Step implementation missing:'</span>, ...snippets].<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n\n'</span>)
                    : <span class="hljs-string">'Step implementation missing'</span>;

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImplementationPending</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImplementationPendingError</span>(message));
            }

            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">PENDING</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImplementationPending</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImplementationPendingError</span>(<span class="hljs-string">'Step implementation pending'</span>));

            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">AMBIGUOUS</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">FAILED</span>: {
                <span class="hljs-keyword">const</span> error = <span class="hljs-title class_">ErrorSerialiser</span>.<span class="hljs-title function_">deserialiseFromStackTrace</span>(worstResult.<span class="hljs-property">message</span>);
                <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">AssertionError</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionFailedWithAssertionError</span>(error);
                }
                <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">TestCompromisedError</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionCompromised</span>(error);
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionFailedWithError</span>(error);
            }

            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">UNKNOWN</span>:
                <span class="hljs-comment">// ignore</span>
            <span class="hljs-keyword">case</span> <span class="hljs-title class_">Status</span>.<span class="hljs-property">PASSED</span>: <span class="hljs-comment">// eslint-disable-line no-fallthrough</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionSuccessful</span>();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">scenarioOutcomeFrom</span>(<span class="hljs-attr">testCaseAttempt</span>: ITestCaseAttempt): { <span class="hljs-attr">outcome</span>: <span class="hljs-title class_">Outcome</span>, <span class="hljs-attr">willBeRetried</span>: <span class="hljs-built_in">boolean</span>, <span class="hljs-attr">tags</span>: <span class="hljs-title class_">Tag</span>[] } {
        <span class="hljs-keyword">const</span> parsed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">formatterHelpers</span>.<span class="hljs-title function_">parseTestCaseAttempt</span>({
            <span class="hljs-attr">cwd</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cwd</span>,
            <span class="hljs-attr">snippetBuilder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">snippetBuilder</span>,
            <span class="hljs-attr">supportCodeLibrary</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">supportCodeLibrary</span>,
            testCaseAttempt
        });

        <span class="hljs-keyword">const</span> worstStepResult   = parsed.<span class="hljs-property">testCase</span>.<span class="hljs-property">worstTestStepResult</span>;
        <span class="hljs-keyword">const</span> willBeRetried     = worstStepResult.<span class="hljs-property">willBeRetried</span>;
        <span class="hljs-keyword">const</span> outcome           = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">outcomeFrom</span>(worstStepResult, ...parsed.<span class="hljs-property">testSteps</span>);

        <span class="hljs-keyword">const</span> tags = [];

        <span class="hljs-keyword">if</span> (testCaseAttempt.<span class="hljs-property">attempt</span> &gt; <span class="hljs-number">0</span> || willBeRetried) {
            tags.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArbitraryTag</span>(<span class="hljs-string">'retried'</span>));
        }

        <span class="hljs-keyword">if</span> (testCaseAttempt.<span class="hljs-property">attempt</span> &gt; <span class="hljs-number">0</span>) {
            tags.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionRetriedTag</span>(testCaseAttempt.<span class="hljs-property">attempt</span>));
        }

        <span class="hljs-keyword">return</span> { outcome, willBeRetried, tags };
    }
}

<span class="hljs-keyword">function</span> flatten&lt;T&gt;(<span class="hljs-attr">listOfLists</span>: T[][]): T[] {
    <span class="hljs-keyword">return</span> listOfLists.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, current</span>) =&gt;</span> acc.<span class="hljs-title function_">concat</span>(current), []);
}

<span class="hljs-keyword">function</span> notEmpty&lt;T&gt;(<span class="hljs-attr">list</span>: T[]) {
    <span class="hljs-keyword">return</span> list.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !!item);
}
</code></pre>

</article>
            </section>
        </div>
    </main>
</section>
</body></html>
</section>

<footer id="footer" class="ftr ftr-accent-2 text-center">
    <div class="container ftr-columns d-print-none">
        <div class="row">
            <div class="col-md-2 ml-auto col-sm-4">
                <h5 class="ftr-column-title ">Get started</h5>
                <ul class="ftr-column-list">
                    <li><a href="/handbook/">Serenity/JS Handbook</a></li>
                    <li><a href="/modules/">API docs</a></li>
                    <li><a href="https://github.com/serenity-js">Template projects</a></li>
                    <li><a href="https://github.com/serenity-js/serenity-js/tree/master/examples">Examples</a></li>
                </ul>
            </div>
            <div class="col-md-2 col-sm-4">
                <h5 class="ftr-column-title ">Support</h5>
                <ul class="ftr-column-list">
                    <li><a href="/support.html">Free Support</a></li>
                    <li><a href="/support.html#training-and-support-services">Training</a></li>
                    <li><a href="/support.html#training-and-support-services">Commercial support</a></li>
                    <li><a href="/community/sponsors.html">Serenity/JS Sponsors</a></li>
                    <li><a href="https://gitter.im/serenity-js/Lobby">Community Chat</a></li>
                </ul>
            </div>
            <div class="col-md-2 mr-auto col-sm-4">
                <h5 class="ftr-column-title">Developers</h5>
                <ul class="ftr-column-list">
                    <li><a href="/contributing.html">Contribute</a></li>
                    <li><a href="/changelog.html">Changelog</a></li>
                    <li><a href="/license.html">License</a></li>
                </ul>
            </div>
        </div>
        <div class="col-lg-6 mx-auto">
            <div class="ftr-column-list">
                <a class="github-button" href="https://github.com/sponsors/serenity-js" data-icon="octicon-heart" data-size="large" aria-label="Sponsor Serenity/JS on GitHub">Sponsor</a>
                <a class="github-button" href="https://github.com/serenity-js/serenity-js" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star jan-molak/serenity-js on GitHub">Star</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-6 mx-auto ftr-bt ftr-oneline ">
                Made with love in London, UK &copy; 2016 - 2021 <a href="https://janmolak.com" target="_blank">Jan Molak</a>, smartcode ltd.
            </div>
        </div>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"
        integrity="sha256-m1eTvwEHwmsw4+XKF7BshClVJEPwTVycveNl0CS0Mkk="
        crossorigin="anonymous"></script>
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<script src="/js/charming-pro.js"></script>

<script src="/js/search_index_initialiser.js"></script>
<script src="/js/inherited-summary.js"></script>
<script src="/js/test-summary.js"></script>
<script src="/js/patch-for-local.js"></script>
<script src="/js/external-links.js"></script>

<script>
    anchors.add('article h1, article h2, article h3, article h4');
</script>

<script type="text/javascript" id="cookieinfo"
        src="//cookieinfoscript.com/js/cookieinfo.min.js"
        data-message="We use analytical cookies to optimise the performance of this website. By continuing to use this site you agree to help us make it better for everyone."
        data-close-text="Got it!"
>
</script>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
        securityLevel: 'loose',
        // theme: 'default',
        flowchart: {
            useMaxWidth: true,
            htmlLabels: true,
        },
        themeVariables: {
            // primaryColor: '#ffffff',
            // primaryBorderColor: '#373a3c',
            fontFamily: '"SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace !important',
            defaultLinkColor: '#c1c1ff',
            edgeLabelBackground: '#fff',
        }
    });
</script>
</body>
</html>
